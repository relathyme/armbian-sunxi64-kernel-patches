--- a/awg/src/Kconfig
+++ /dev/null
@@ -1,33 +0,0 @@
-config AMNEZIAWG
-	tristate "IP: AmneziaWG secure network tunnel"
-	depends on NET && INET
-	depends on IPV6 || !IPV6
-	select NET_UDP_TUNNEL
-	select DST_CACHE
-	select CRYPTO
-	select CRYPTO_ALGAPI
-	select VFP
-	select VFPv3 if CPU_V7
-	select NEON if CPU_V7
-	select KERNEL_MODE_NEON if CPU_V7
-	default m
-	help
-	  WireGuard is a secure, fast, and easy to use replacement for IPsec
-	  that uses modern cryptography and clever networking tricks. It's
-	  designed to be fairly general purpose and abstract enough to fit most
-	  use cases, while at the same time remaining extremely simple to
-	  configure. See www.wireguard.com for more info.
-
-	  It's safe to say Y or M here, as the driver is very lightweight and
-	  is only in use when an administrator chooses to add an interface.
-
-config AMNEZIAWG_DEBUG
-	bool "Debugging checks and verbose messages"
-	depends on AMNEZIAWG
-	help
-	  This will write log messages for handshake and other events
-	  that occur for a WireGuard interface. It will also perform some
-	  extra validation checks and unit tests at various points. This is
-	  only useful for debugging.
-
-	  Say N here unless you know what you're doing.
--- a/awg/src/Makefile
+++ b/awg/src/Makefile
@@ -1,60 +1,3 @@
-# SPDX-License-Identifier: GPL-2.0
-#
-# Copyright (C) 2015-2019 Jason A. Donenfeld <Jason@zx2c4.com>. All Rights Reserved.
-
-WIREGUARD_VERSION = 1.0.0
-OMIT_ENDPOINTS ?=
-
-KERNELRELEASE ?= $(shell uname -r)
-KERNELDIR ?= /lib/modules/$(KERNELRELEASE)/build
-PREFIX ?= /usr
-DESTDIR ?=
-SRCDIR ?= $(PREFIX)/src
-DKMSDIR ?= $(SRCDIR)/amneziawg-$(WIREGUARD_VERSION)
-DEPMOD ?= depmod
-DEPMODBASEDIR ?= /
-
-PWD := $(shell pwd)
-
-all: module
-debug: module-debug
-
-ifneq ($(V),1)
-MAKEFLAGS += --no-print-directory
-endif
-
-module:
-	@$(MAKE) -C $(KERNELDIR) M=$(PWD) WIREGUARD_VERSION="$(WIREGUARD_VERSION)" OMIT_ENDPOINTS="$(OMIT_ENDPOINTS)" modules
-
-module-debug:
-	@$(MAKE) -C $(KERNELDIR) M=$(PWD) V=1 CONFIG_AMNEZIAWG_DEBUG=y WIREGUARD_VERSION="$(WIREGUARD_VERSION)" OMIT_ENDPOINTS="$(OMIT_ENDPOINTS)" modules
-
-clean:
-	@$(MAKE) -C $(KERNELDIR) M=$(PWD) clean
-
-module-install:
-	@$(MAKE) -C $(KERNELDIR) M=$(PWD) WIREGUARD_VERSION="$(WIREGUARD_VERSION)" OMIT_ENDPOINTS="$(OMIT_ENDPOINTS)" modules_install
-	$(DEPMOD) -b "$(DEPMODBASEDIR)" -a $(KERNELRELEASE)
-
-install: module-install
-
-rwildcard=$(foreach d,$(wildcard $1*),$(call rwildcard,$d/,$2) $(filter $(subst *,%,$2),$d))
-DKMS_SOURCES := version.h Makefile Kbuild Kconfig dkms.conf $(filter-out version.h wireguard.mod.c tests/%,$(call rwildcard,,*.c *.h *.S *.pl *.include))
-dkms-install: $(DKMS_SOURCES)
-	@$(foreach f,$(DKMS_SOURCES),install -v -m0644 -D $(f) $(DESTDIR)$(DKMSDIR)/$(f);)
-
-style:
-	$(KERNELDIR)/scripts/checkpatch.pl -f --max-line-length=4000 --codespell --color=always $(filter-out wireguard.mod.c,$(wildcard *.c)) $(wildcard *.h) $(wildcard selftest/*.c)
-
-check: clean
-	scan-build --html-title=wireguard-linux-compat -maxloop 100 --view --keep-going $(MAKE) module CONFIG_WIREGUARD_DEBUG=y C=2 CF="-D__CHECK_ENDIAN__"
-
-coccicheck: clean
-	@$(MAKE) -C $(KERNELDIR) M=$(PWD) CONFIG_WIREGUARD_DEBUG=y coccicheck MODE=report
-
-cloc:
-	@cloc --skip-uniqueness --by-file --extract-with="$$(readlink -f ../kernel-tree-scripts/filter-compat-defines.sh) >FILE< > \$$(basename >FILE<)" $(filter-out wireguard.mod.c,$(wildcard *.c)) $(wildcard *.h)
-
--include tests/debug.mk
-
-.PHONY: all module module-debug apply-patches module-install install dkms-install clean cloc check style
+ccflags-y := -D'pr_fmt(fmt)=KBUILD_MODNAME ": " fmt'
+ccflags-$(CONFIG_AMNEZIAWG_DEBUG) += -DDEBUG
+obj-$(CONFIG_AMNEZIAWG) := amneziawg.o
--- a/drivers/net/Makefile
+++ b/drivers/net/Makefile
@@ -11,6 +11,7 @@
 obj-$(CONFIG_IPVTAP) += ipvlan/
 obj-$(CONFIG_DUMMY) += dummy.o
 obj-$(CONFIG_WIREGUARD) += wireguard/
+obj-$(CONFIG_AMNEZIAWG) += amneziawg/
 obj-$(CONFIG_EQUALIZER) += eql.o
 obj-$(CONFIG_IFB) += ifb.o
 obj-$(CONFIG_MACSEC) += macsec.o
--- a/drivers/net/Kconfig
+++ b/drivers/net/Kconfig
@@ -115,6 +115,40 @@
 
 	  Say N here unless you know what you're doing.
 
+config AMNEZIAWG
+        tristate "IP: AmneziaWG secure network tunnel"
+        depends on NET && INET
+        depends on IPV6 || !IPV6
+        select NET_UDP_TUNNEL
+        select DST_CACHE
+        select CRYPTO
+        select CRYPTO_ALGAPI
+        select VFP
+        select VFPv3 if CPU_V7
+        select NEON if CPU_V7
+        select KERNEL_MODE_NEON if CPU_V7
+        default m
+        help
+          WireGuard is a secure, fast, and easy to use replacement for IPsec
+          that uses modern cryptography and clever networking tricks. It's
+          designed to be fairly general purpose and abstract enough to fit most
+          use cases, while at the same time remaining extremely simple to
+          configure. See www.wireguard.com for more info.
+
+          It's safe to say Y or M here, as the driver is very lightweight and
+          is only in use when an administrator chooses to add an interface.
+
+config AMNEZIAWG_DEBUG
+        bool "Debugging checks and verbose messages"
+        depends on AMNEZIAWG
+        help
+          This will write log messages for handshake and other events
+          that occur for a WireGuard interface. It will also perform some
+          extra validation checks and unit tests at various points. This is
+          only useful for debugging.
+
+          Say N here unless you know what you're doing.
+
 config EQUALIZER
 	tristate "EQL (serial line load balancing) support"
 	help
